<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kabintify Code Panel - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3119/3119338.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4 pb-24 font-sans text-slate-900">
    <div class="max-w-5xl mx-auto bg-white p-6 rounded-2xl shadow-xl border border-slate-100">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 border-b pb-6">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-indigo-100 rounded-2xl flex items-center justify-center shadow-inner">
                    <img id="head-icon" src="https://cdn-icons-png.flaticon.com/512/3119/3119338.png" alt="Bell Icon" class="w-8 h-8 object-contain">
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-indigo-600 leading-tight">Kabintify Code Editor ü§ñ</h1>
                    <a href="https://kabintify.site" class="text-xs font-bold text-slate-400 hover:text-indigo-500 transition-colors flex items-center gap-1 mt-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å
                    </a>
                </div>
            </div>

            <div class="flex gap-2 w-full md:w-auto">
                <input type="password" id="token" class="flex-1 p-2 bg-slate-50 border rounded-lg text-sm focus:ring-2 focus:ring-indigo-400 outline-none" placeholder="‡∏ß‡∏≤‡∏á LINE Access Token" onchange="saveToLocal()">
                <button onclick="resetData()" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-200 transition">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>

        <div id="editor-container" class="space-y-6">
            </div>

        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t shadow-lg z-50">
            <div class="max-w-5xl mx-auto">
                <button onclick="generateFullCode()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl text-lg shadow-lg transition-all active:scale-95">
                    üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Termux (Broadcast)
                </button>
            </div>
        </div>

        <div id="result-area" class="mt-8 hidden pb-10">
            <h2 class="text-lg font-bold mb-2 text-slate-700">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Termux:</h2>
            <div class="relative group">
                <textarea id="output-code" class="w-full h-96 p-4 bg-slate-900 text-green-400 font-mono text-xs rounded-xl border-4 border-slate-800 focus:outline-none" readonly></textarea>
                <button onclick="copyCode()" class="absolute top-4 right-4 bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-md text-sm border border-white/20 backdrop-blur-sm transition-all">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const defaultData = {
            "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": [
                {time: "08:00-10:00", name: "20204-2008 ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤", room: "432"},
                {time: "13:00-15:00", name: "20204-2106 ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥", teacher: "‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå", room: "434"},
                {time: "15:00-16:00", name: "20204-8501 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", room: "443"}
            ],
            "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": [
                {time: "08:00-10:00", name: "20000-1204 ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", teacher: "‡∏Ñ‡∏£‡∏π‡∏†‡∏≤‡∏ì‡∏∏‡∏û‡∏á‡∏©‡πå", room: "123"},
                {time: "13:00-14:00", name: "20000-1502 ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢", teacher: "‡∏Ñ‡∏£‡∏π‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏≤", room: "136"}
            ],
            "‡∏û‡∏∏‡∏ò": [
                {time: "08:00-11:00", name: "20000-1303 ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", teacher: "‡∏Ñ‡∏£‡∏π‡∏ô‡∏†‡∏™‡∏£", room: "137"},
                {time: "13:00-14:00", name: "Home Room", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", room: "443"},
                {time: "14:00-16:00", name: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏°", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", room: "443"}
            ],
            "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": [
                {time: "08:00-10:00", name: "20000-1208 ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°", teacher: "‡∏Ñ‡∏£‡∏π‡∏≠‡∏ä‡∏¥‡∏ï‡∏≤", room: "122"},
                {time: "10:00-12:00", name: "20204-2106 ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ", teacher: "‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå", room: "434"},
                {time: "13:00-15:00", name: "20204-2008 ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤", room: "432"},
                {time: "15:00-16:00", name: "20204-8501 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô", teacher: "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", room: "443"}
            ],
            "‡∏®‡∏∏‡∏Å‡∏£‡πå": [
                {time: "08:00-10:00", name: "20001-1001 ‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢", teacher: "‡∏Ñ‡∏£‡∏π‡∏Å‡∏©‡∏≤‡∏õ‡∏ì‡πå", room: "‡πÇ‡∏î‡∏°"},
                {time: "12:00-15:00", name: "20001-1003 ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£", teacher: "‡∏Ñ‡∏£‡∏π‡∏ô‡∏¥‡∏ï‡∏¥‡∏¢‡∏≤", room: "441"}
            ]
        };

        let fullData = JSON.parse(localStorage.getItem('kabintify_data')) || defaultData;
        document.getElementById('token').value = localStorage.getItem('kabintify_token') || '';

        function renderEditor() {
            const container = document.getElementById('editor-container');
            container.innerHTML = '';
            
            Object.keys(fullData).forEach(day => {
                let dayHtml = `
                    <div class="bg-gray-100 p-5 rounded-2xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800">üìÖ ‡∏ß‡∏±‡∏ô${day}</h3>
                            <button onclick="addRow('${day}')" class="bg-green-500 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-green-600 transition-colors">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤</button>
                        </div>
                        <div class="space-y-3">
                `;
                
                fullData[day].forEach((subj, idx) => {
                    dayHtml += `
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-2 bg-white p-3 rounded-xl shadow-sm border border-gray-200 relative group">
                            <div><label class="text-[10px] text-gray-400 uppercase font-bold">‡πÄ‡∏ß‡∏•‡∏≤</label><input type="text" class="w-full text-xs p-2 bg-slate-50 border rounded focus:ring-2 focus:ring-indigo-300 outline-none" value="${subj.time}" onchange="updateData('${day}', ${idx}, 'time', this.value)"></div>
                            <div class="md:col-span-2"><label class="text-[10px] text-gray-400 uppercase font-bold">‡∏ß‡∏¥‡∏ä‡∏≤</label><input type="text" class="w-full text-xs p-2 bg-slate-50 border rounded focus:ring-2 focus:ring-indigo-300 outline-none" value="${subj.name}" onchange="updateData('${day}', ${idx}, 'name', this.value)"></div>
                            <div><label class="text-[10px] text-gray-400 uppercase font-bold">‡∏Ñ‡∏£‡∏π</label><input type="text" class="w-full text-xs p-2 bg-slate-50 border rounded focus:ring-2 focus:ring-indigo-300 outline-none" value="${subj.teacher}" onchange="updateData('${day}', ${idx}, 'teacher', this.value)"></div>
                            <div class="flex gap-2">
                                <div class="flex-1"><label class="text-[10px] text-gray-400 uppercase font-bold">‡∏´‡πâ‡∏≠‡∏á</label><input type="text" class="w-full text-xs p-2 bg-slate-50 border rounded focus:ring-2 focus:ring-indigo-300 outline-none" value="${subj.room}" onchange="updateData('${day}', ${idx}, 'room', this.value)"></div>
                                <button onclick="removeRow('${day}', ${idx})" class="mt-4 text-slate-300 hover:text-red-500 transition-colors">‚úï</button>
                            </div>
                        </div>
                    `;
                });
                dayHtml += `</div></div>`;
                container.innerHTML += dayHtml;
            });
        }

        function addRow(day) { fullData[day].push({time: "00:00-00:00", name: "‡∏ß‡∏¥‡∏ä‡∏≤‡πÉ‡∏´‡∏°‡πà", teacher: "‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π", room: "000"}); saveToLocal(); renderEditor(); }
        function removeRow(day, idx) { if(confirm('‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) { fullData[day].splice(idx, 1); saveToLocal(); renderEditor(); } }
        function updateData(day, idx, field, value) { fullData[day][idx][field] = value; saveToLocal(); }
        function saveToLocal() { localStorage.setItem('kabintify_data', JSON.stringify(fullData)); localStorage.setItem('kabintify_token', document.getElementById('token').value); }
        function resetData() { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) { localStorage.clear(); location.reload(); } }

        function generateFullCode() {
            const token = document.getElementById('token').value || 'YOUR_ACCESS_TOKEN';
            const daySubjectsStr = JSON.stringify(fullData, null, 4).replace(/"/g, "'");
            
            let remindersBody = '';
            Object.keys(fullData).forEach(day => {
                remindersBody += `    '${day}': {\n`;
                fullData[day].forEach(s => {
                    const startTime = s.time.split('-')[0];
                    remindersBody += `        '${startTime}': '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ${s.name} (${s.teacher}) ‡∏´‡πâ‡∏≠‡∏á ${s.room}',\n`;
                });
                remindersBody += `    },\n`;
            });

            const pythonTemplate = `import requests\nimport time\nfrom datetime import datetime, timedelta\n\nLINE_ACCESS_TOKEN = '${token}'\n\ndef send_line_flex(day, subjects):\n    url = \"https://api.line.me/v2/bot/message/broadcast\"\n    headers = {\"Content-Type\": \"application/json\", \"Authorization\": f\"Bearer {LINE_ACCESS_TOKEN}\"}\n    subject_rows = []\n    for s in subjects:\n        subject_rows.append({\"type\": \"box\", \"layout\": \"horizontal\", \"margin\": \"md\", \"contents\": [{\"type\": \"text\", \"text\": s['time'], \"size\": \"xs\", \"color\": \"#888888\", \"flex\": 2}, {\"type\": \"text\", \"text\": f\"{s['name']}\\n{s['teacher']}\\n‡∏´‡πâ‡∏≠‡∏á {s['room']}\", \"size\": \"sm\", \"weight\": \"bold\", \"wrap\": True, \"flex\": 5}]})\n    colors = {\"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå\": \"#FFB800\", \"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£\": \"#FF4B91\", \"‡∏û‡∏∏‡∏ò\": \"#00B900\", \"‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ\": \"#FF7A00\", \"‡∏®‡∏∏‡∏Å‡∏£‡πå\": \"#0099FF\"}\n    payload = {\"messages\": [{\"type\": \"flex\", \"altText\": f\"‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô{day}\", \"contents\": {\"type\": \"bubble\", \"header\": {\"type\": \"box\", \"layout\": \"vertical\", \"backgroundColor\": colors.get(day, \"#333333\"), \"contents\": [{\"type\": \"text\", \"text\": \"‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏ò.3/2\", \"weight\": \"bold\", \"color\": \"#FFFFFF\", \"size\": \"xl\"}, {\"type\": \"text\", \"text\": f\"‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô{day}\", \"color\": \"#FFFFFFCC\", \"size\": \"sm\"}]}, \"body\": {\"type\": \"box\", \"layout\": \"vertical\", \"contents\": [{\"type\": \"text\", \"text\": \"‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\", \"weight\": \"bold\", \"size\": \"md\"}, {\"type\": \"separator\", \"margin\": \"md\"}, {\"type\": \"box\", \"layout\": \"vertical\", \"margin\": \"md\", \"contents\": subject_rows}]}}}]}\n    requests.post(url, headers=headers, json=payload)\n\ndef send_line_text(text):\n    url = \"https://api.line.me/v2/bot/message/broadcast\"\n    headers = {\"Content-Type\": \"application/json\", \"Authorization\": f\"Bearer {LINE_ACCESS_TOKEN}\"}\n    payload = {\"messages\": [{\"type\": \"text\", \"text\": \"üì¢ \" + text}]}\n    requests.post(url, headers=headers, json=payload)\n\ndef get_thai_day():\n    days = {\"Monday\": \"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå\", \"Tuesday\": \"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£\", \"Wednesday\": \"‡∏û‡∏∏‡∏ò\", \"Thursday\": \"‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ\", \"Friday\": \"‡∏®‡∏∏‡∏Å‡∏£‡πå\"}\n    return days.get(datetime.now().strftime(\"%A\"))\n\nday_subjects = ${daySubjectsStr}\ntext_reminders = {\n${remindersBody}}\n\ndef get_next_event():\n    now = datetime.now()\n    day_thai = get_thai_day()\n    today_times = [\"07:30\"]\n    if day_thai in text_reminders: today_times.extend(text_reminders[day_thai].keys())\n    future_events = []\n    for t_str in sorted(list(set(today_times))):\n        target = now.replace(hour=int(t_str[:2]), minute=int(t_str[3:]), second=0, microsecond=0)\n        if target > now: future_events.append((target, t_str))\n    if not future_events:\n        next_day = now + timedelta(days=1)\n        return next_day.replace(hour=7, minute=30, second=0, microsecond=0), \"07:30\"\n    return future_events[0]\n\nif __name__ == \"__main__\":\n    print(\">>> ‡∏ö‡∏≠‡∏ó Kabintify ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...\")\n    while True:\n        target_dt, t_str = get_next_event()\n        wait_seconds = (target_dt - datetime.now()).total_seconds()\n        print(f\"[{datetime.now().strftime('%H:%M:%S')}] ‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: {t_str} (‡∏≠‡∏µ‡∏Å {wait_seconds/60:.1f} ‡∏ô‡∏≤‡∏ó‡∏µ)\")\n        time.sleep(max(0, wait_seconds))\n        day_thai = get_thai_day()\n        if t_str == \"07:30\":\n            if day_thai in day_subjects: send_line_flex(day_thai, day_subjects[day_thai])\n        elif day_thai in text_reminders and t_str in text_reminders[day_thai]:\n            send_line_text(text_reminders[day_thai][t_str])\n        time.sleep(2)`;

            document.getElementById('output-code').value = pythonTemplate;
            document.getElementById('result-area').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function copyCode() { const textarea = document.getElementById('output-code'); textarea.select(); document.execCommand('copy'); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); }

        renderEditor();
    </script>
</body>
</html>