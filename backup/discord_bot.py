import requests
import os
from datetime import datetime, timedelta

WEBHOOK_URL = os.getenv('DISCORD_WEBHOOK')

def send_discord(content=None, embed=None):
    payload = {}
    if content: payload['content'] = content
    if embed: payload['embeds'] = [embed]
    requests.post(WEBHOOK_URL, json=payload)

def get_embed(day, subjects):
    colors = {"Monday": 16758784, "Tuesday": 16731025, "Wednesday": 47360, "Thursday": 16742912, "Friday": 39423}
    fields = [{"name": f"‚è∞ {s['time']}", "value": f"**{s['name']}**\n{s['teacher']} | ‡∏´‡πâ‡∏≠‡∏á: {s['room']}", "inline": False} for s in subjects]
    return {"title": f"üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ñ‡∏ò.3/2 - ‡∏ß‡∏±‡∏ô{day}", "color": colors.get(day, 3447003), "fields": fields}

day_subjects = {
    "Monday": [{"time": "08:00-10:00", "name": "20204-2008 ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤", "room": "432"}, {"time": "13:00-15:00", "name": "20204-2106 ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥", "teacher": "‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå", "room": "434"}, {"time": "15:00-16:00", "name": "20204-8501 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "room": "443"}],
    "Tuesday": [{"time": "08:00-10:00", "name": "20000-1204 ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô", "teacher": "‡∏Ñ‡∏£‡∏π‡∏†‡∏≤‡∏ì‡∏∏‡∏û‡∏á‡∏©‡πå", "room": "123"}, {"time": "13:00-14:00", "name": "20000-1502 ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢", "teacher": "‡∏Ñ‡∏£‡∏π‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏≤", "room": "136"}],
    "Wednesday": [{"time": "08:00-11:00", "name": "20000-1303 ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ô‡∏†‡∏™‡∏£", "room": "137"}, {"time": "13:00-14:00", "name": "Home Room", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "room": "443"}, {"time": "14:00-16:00", "name": "20000-2007 ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏°", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "room": "443"}],
    "Thursday": [{"time": "08:00-10:00", "name": "20000-1208 ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "teacher": "‡∏Ñ‡∏£‡∏π‡∏≠‡∏ä‡∏¥‡∏ï‡∏≤", "room": "122"}, {"time": "10:00-12:00", "name": "20204-2106 ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥", "teacher": "‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå", "room": "434"}, {"time": "13:00-15:00", "name": "20204-2008 ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤", "room": "432"}, {"time": "15:00-16:00", "name": "20204-8501 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "room": "443"}],
    "Friday": [{"time": "08:00-10:00", "name": "20001-1001 ‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢", "teacher": "‡∏Ñ‡∏£‡∏π‡∏Å‡∏©‡∏≤‡∏õ‡∏ì‡πå", "room": "‡πÇ‡∏î‡∏°"}, {"time": "12:00-15:00", "name": "20001-1003 ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£", "teacher": "‡∏Ñ‡∏£‡∏π‡∏ô‡∏¥‡∏ï‡∏¥‡∏¢‡∏≤", "room": "441"}]
}

text_reminders = {
    "Monday": {"07:40": "summary", "08:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏´‡πâ‡∏≠‡∏á 432 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤)", "13:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡∏´‡πâ‡∏≠‡∏á 434 (‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå)", "15:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡πâ‡∏≠‡∏á 443 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤)"},
    "Tuesday": {"07:40": "summary", "08:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏´‡πâ‡∏≠‡∏á 123 (‡∏Ñ‡∏£‡∏π‡∏†‡∏≤‡∏ì‡∏∏‡∏û‡∏á‡∏©‡πå)", "13:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢ ‡∏´‡πâ‡∏≠‡∏á 136 (‡∏Ñ‡∏£‡∏π‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏≤)"},
    "Wednesday": {"07:40": "summary", "08:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏´‡πâ‡∏≠‡∏á 137 (‡∏Ñ‡∏£‡∏π‡∏ô‡∏†‡∏™‡∏£)", "13:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Home Room ‡∏´‡πâ‡∏≠‡∏á 443 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤)", "14:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏£‡∏£‡∏° ‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏° ‡∏´‡πâ‡∏≠‡∏á 443 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤)"},
    "Thursday": {"07:40": "summary", "08:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏´‡πâ‡∏≠‡∏á 122 (‡∏Ñ‡∏£‡∏π‡∏≠‡∏ä‡∏¥‡∏ï‡∏≤)", "10:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡∏´‡πâ‡∏≠‡∏á 434 (‡∏Ñ‡∏£‡∏π‡∏û‡∏£‡∏û‡∏¥‡∏á‡∏Ñ‡πå)", "13:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡∏´‡πâ‡∏≠‡∏á 432 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏°‡∏ì‡∏ë‡∏≤)", "15:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡πâ‡∏≠‡∏á 443 (‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤)"},
    "Friday": {"07:40": "summary", "08:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏ì ‡πÇ‡∏î‡∏° (‡∏Ñ‡∏£‡∏π‡∏Å‡∏©‡∏≤‡∏õ‡∏ì‡πå)", "12:00": "üì¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ ‡∏´‡πâ‡∏≠‡∏á 441 (‡∏Ñ‡∏£‡∏π‡∏ô‡∏¥‡∏ï‡∏¥‡∏¢‡∏≤)"}
}

if __name__ == "__main__":
    now_th = datetime.utcnow() + timedelta(hours=7)
    day, hm = now_th.strftime("%A"), now_th.strftime("%H:%M")
    if day in text_reminders:
        for t, msg in text_reminders[day].items():
            if datetime.strptime(t, "%H:%M") <= datetime.strptime(hm, "%H:%M") <= datetime.strptime(t, "%H:%M") + timedelta(minutes=15):
                if msg == "summary": send_discord(embed=get_embed(day, day_subjects[day]))
                else: send_discord(content=msg)
                break
